---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("posts")).sort((a, b) => {
  const da = a.data.pubDate ? a.data.pubDate.getTime() : 0;
  const db = b.data.pubDate ? b.data.pubDate.getTime() : 0;
  return db - da; // más reciente primero
});
---

<Layout title="Posts — HFT, C++ y baja latencia">
  <section class="posts">
    <h1>Posts técnicos</h1>
    <p class="posts-intro">
      Notas sobre diseño de infraestructura HFT, estructuras de datos para order books,
      FIX, latencia, market making y optimización de sistemas de trading.
    </p>

    <div class="posts-grid">
      {posts.map((post) => (
        <article class="post-card">
          <a href={`/posts/${post.slug}/`} class="post-card-link">
            <div class="post-card-meta">
              {post.data.category && (
                <span class={`pill pill-${post.data.category.toLowerCase()}`}>
                  {post.data.category}
                </span>
              )}

              {post.data.pubDate && (
                <time datetime={post.data.pubDate.toISOString()}>
                  {post.data.pubDate.toISOString().slice(0, 10)}
                </time>
              )}
            </div>

            <h2>{post.data.title}</h2>

            {post.data.description && (
              <p class="post-card-desc">
                {post.data.description}
              </p>
            )}
          </a>
        </article>
      ))}
    </div>
  </section>
</Layout>
